<!DOCTYPE html>
<html lang="en">
<head>
<!--initialize the firebase SDK both for the app and auth--> 
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

<!--declares the encoding-->  
  <meta charset="UTF-8" />
  <!--scale the page to the devices size-->  
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!--title for the browser-->  
  <title>Login / Signup</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f0f0f0;
      height: 100vh;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .auth-container {
      background-color: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      width: 300px;
    }

    h2 {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    input {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    button {
      width: 100%;
      padding: 0.75rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    .switch {
      background: none;
      border: none;
      color: #007bff;
      text-decoration: underline;
      cursor: pointer;
      margin-top: 1rem;
    }
    /* makes an item invisible in the UI */
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="auth-container">
    <!-- login form -->
    <div id="loginForm">
      <h2>Login</h2>
      <input type="email" id="loginEmail" placeholder="Email" required />
      <input type="password" id="loginPassword" placeholder="Password" required />
      <button onclick="login()">Log In</button>
      <button class="switch" onclick="showSignup()">Create Account</button>
    </div>

    <!-- signup form -->
    <div id="signupForm" class="hidden">
      <h2>Sign Up</h2>
      <input type="text" id="signupName" placeholder="Full Name" required />
      <input type="email" id="signupEmail" placeholder="Email" required />
      <input type="password" id="signupPassword" placeholder="Password" required />
      <button onclick="signup()">Sign Up</button>
      <button class="switch" onclick="showLogin()">Already have an account?</button>
    </div>
  </div>

  <script>
    const firebaseConfig = {
        //ADD API KEY FROM FIREBASE
        apiKey: "FIREBASEAPI",
        authDomain: "comp380-project.firebaseapp.com",
        projectId: "comp380-project",
        storageBucket: "comp380-project.firebasestorage.app",
        messagingSenderId: "600625641164",
        appId: "1:600625641164:web:08ae615ac03593930d7469",
        measurementId: "G-Z4CSFDJFNB"
    };

    firebase.initializeApp(firebaseConfig);
    //initialize auth to use for login / signup 
    const auth = firebase.auth();

    function showSignup() {
        // Grabs the element with the Id of loginForm up in the form 
        // the .classlist.add("hidden") make the login from invisible when this button is pressed
        // inorder to make room to show the signup view
      document.getElementById("loginForm").classList.add("hidden");
        // this grabs the form with teh Id of signupForm and removes the invisibility to make it appear
      document.getElementById("signupForm").classList.remove("hidden");
    }

    function showLogin() {
        //grabs the signupForm by the Id and makes it invisble to show the login form
      document.getElementById("signupForm").classList.add("hidden");
        //grabs the loginForm and removes the invisibility to make it show up instead of the signup form
      document.getElementById("loginForm").classList.remove("hidden");
    }

    // similar to signup function read comments for that please 
    async function login() {
        //grabs the login email by the id from the login to use for firebase auth
        const email = document.getElementById("loginEmail").value;
        //grabs the password by the id from the login form to use for firebase auth 
        const password = document.getElementById("loginPassword").value;
        //print for testing
        console.log("Logging in:", email, password);
        // Add Firebase login logic here
        try {
            // log the user in using firebase method
            const userCredential = await auth.signInWithEmailAndPassword(email, password);
            const user = userCredential.user;
            // for testing
            console.log("Logged in as:", user.email);
            //simple alert for now 
            alert("Login successful!");
            // MARK -- Setup home page  -- DONE 
            window.location.href = "homepage.html";
        } catch (error) {
            console.error("Login error:", error.code, error.message);
            alert("Login failed: " + error.message);
        }
    }
    //async is used for functions that use await (they might sleep)
    async function signup() {
        //grab the name by the Id to use for user creation
        const name = document.getElementById("signupName").value;
        //grab the signup email to use later for account creation 
        const email = document.getElementById("signupEmail").value;
        //pass for account
        const password = document.getElementById("signupPassword").value;

        try { 
            //sing up the user by the credentials provided marked by await 
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            //grab the current user 
            const user = userCredential.user;

            // Update display name
            await user.updateProfile({ displayName: name });

            // Send verification email
            await user.sendEmailVerification();
            alert("Verification email sent. Please check your inbox.");

            // Poll for verification
            const checkInterval = setInterval(async () => {
                await user.reload(); // refresh auth state
                if (user.emailVerified) {
                clearInterval(checkInterval);
                alert("Email verified! Redirecting...");
                //MARK -- Change to home view 
                window.location.href = "homepage.html"; 
                } else {
                    console.log("Still waiting for verification...");
                }
            }, 3000);
        } catch (error) {
            //catch errors in signup
            console.error("Signup error:", error.code, error.message);
            //show error as alert for now 
            alert("Signup failed: " + error.message);
        }
    }
  </script>
</body>
</html>